syntoniq(version=1)
tempo(bpm=60)

; Define two 5-note scales with different pitches and partial overlap
; in note names.
define_scale(

  ; comment and blank line here

  scale="5-EDO"

) <<
  ^0|5 p
  ; comment in scale definition
  ^1|5 q

  ; also blank lines

  ^2|5 r
  ^3|5 s
  ^4|5 t
     2 w  ; same pitch class as p but out of cycle
  ^7|6 x  ; out of cycle, unique pitch class
>>
define_scale(scale="5-JI" cycle_ratio=2) <<
    1 p
  5/4 q
  4/3 r
  3/2 u
  7/4 v
>>

[p1.0]  1:c d e' f,

use_scale(scale="5-EDO" part=p1)

[p1.0]  1:p'2 q,2:> r:^ s:~
[p2.1]  1:c   d:.   e:> f:.^

; Transpose to set the base pitch to the current pitch of `d`, then
; switch to the 5-JI scale for p2.
transpose(written=c pitch_from=d part=p2) use_scale(scale="5-JI" part=p2)

mark(label="a")
tempo(bpm=72 start_time=1 end_bpm=96 duration=2)
[p1.0]  1:p q r s
[p2.1]  1:p q r u
[p3.0]  1:a e ~ 1/2:b% b#
  [p3]  64@2< 96@3
mark(label="b")

; Exercise scale degree logic more thoroughly by having notes that
; extend outside the cycle (beyond b#). This ensures notes are sorted
; properly. These go up by fifths.
define_scale(scale="fifths" cycle_ratio=2) <<
   1    c cc
   3/2  g
   9/4  d  ;  9/8
  27/8  a  ; 27/16
  81/16 e  ; 81/64
>>
define_scale(scale="fifths-3" cycle_ratio=3) <<
   1    c! c!!
   1/2  g!  ;  3/2  * cycle
   9/4  d!
  27/8  a!  ;  9/8  * cycle
  81/16 e!  ; 27/16 * cycle
>>
use_scale(scale="fifths" part=p1) set_base_pitch(absolute=264 part=p1)
use_scale(scale="fifths-3" part=p2) set_base_pitch(absolute=264 part=p2)
[p1.1] 2/5:c d, e,2 1/5:g:~ g 2/5:a,
[p2.1] 2/5:c!' a! g!'2 e! d!'

repeat(start="a" end="b")

; Create a manual mapping that has all the notes from 5-EDO
define_manual_mapping(mapping="m1" scale="5-EDO") <<
t ~ w x p'
p @q r s p,
>>
define_isomorphic_mapping(mapping="m2" steps_h=2 steps_v=5)
; Place the manual mapping in two distinct spots with different parameters.
place_mapping(
    layout="l1"
    mapping="m1"
    base_pitch=400
    keyboard="k"
    anchor_row=5
    anchor_col=4
    rows_above=3
    rows_below=1
    cols_left=2
    cols_right=6
)
place_mapping(
    layout="l1"
    mapping="m1"
    base_pitch=500
    keyboard="k"
    anchor_row=1
    anchor_col=8
    rows_above=1
    rows_below=0
    cols_left=1
    cols_right=2
)
; Place the isomorphic mapping to cover the whole keyboard
place_mapping(
    layout="l1"
    mapping="m2"
    base_pitch=300
    keyboard="k"
    anchor_row=12
    anchor_col=7
)
