syntoniq(version=1)
tempo(bpm=60)

; Define two 5-note scales with different pitches and partial overlap
; in note names.
define_scale(name="5-EDO") <<
  ^0|5 p
  ^1|5 q
  ^2|5 r
  ^3|5 s
  ^4|5 t
>>
define_scale(name="5-JI" cycle_ratio=2) <<
    1 p
  5/4 q
  4/3 r
  3/2 u
  7/4 v
>>

[p1.0]  1:c d e' f,

use_scale(name="5-EDO" part="p1")

[p1.0]  1:p'2 q,2(>) r(^) s~
[p2.1]  1:c   d(.)   e(>) f(.^)

; Transpose to set the base pitch to the current pitch of `d`, then
; switch to the 5-JI scale for p2.
transpose(written="c" pitch_from="d" part="p2") use_scale(name="5-JI" part="p2")

tempo(bpm=72 start_time=1 end_bpm=96 duration=2)
[p1.0]  1:p q r s
[p2.1]  1:p q r u
[p3.0]  1:a e ~ 1/2:b% b#
  [p3]  64@2< 96@3

; Exercise scale degree logic more thoroughly by having notes that
; extend outside the cycle (beyond b#). This ensures notes are sorted
; properly. These go up by fifths.
define_scale(name="fifths" cycle_ratio=2) <<
   1    c
   3/2  g
   9/4  d  ;  9/8
  27/8  a  ; 27/16
  81/16 e  ; 81/64
>>
define_scale(name="fifths-3" cycle_ratio=3) <<
   1    c!
   1/2  g!  ;  3/2  * cycle
   9/4  d!
  27/8  a!  ;  9/8  * cycle
  81/16 e!  ; 27/16 * cycle
>>
use_scale(name="fifths" part="p1") set_base_pitch(absolute=264 part="p1")
use_scale(name="fifths-3" part="p2") set_base_pitch(absolute=264 part="p2")
[p1.1] 2/5:c d, e,2 1/5:g~ g 2/5:a,
[p2.1] 2/5:c!' a! g!'2 e! d!'
